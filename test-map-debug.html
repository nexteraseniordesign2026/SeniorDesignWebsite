<!DOCTYPE html>
<html>
<head>
    <title>Map Debug Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="dynamodb-service.js"></script>
    <script src="config.js"></script>
</head>
<body class="p-8">
    <h1 class="text-2xl font-bold mb-4">Map Debug Test</h1>
    <button onclick="testMap()" class="bg-blue-500 text-white px-4 py-2 rounded mb-4">Test Map & Markers</button>
    <div id="map" style="width: 100%; height: 600px; border: 2px solid #ccc;"></div>
    <div id="log" class="mt-4 p-4 bg-gray-100 rounded"></div>
    
    <script>
        let map, markers = {};
        
        function log(msg) {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + msg + '</div>';
            console.log(msg);
        }
        
        async function testMap() {
            log('Starting test...');
            
            // Load Google Maps
            if (typeof google === 'undefined') {
                const script = document.createElement('script');
                script.src = `https://maps.googleapis.com/maps/api/js?key=${window.GOOGLE_MAPS_API_KEY}`;
                script.onload = () => {
                    log('Google Maps loaded');
                    initMap();
                };
                document.head.appendChild(script);
            } else {
                initMap();
            }
        }
        
        function initMap() {
            log('Initializing map...');
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 38.922, lng: -83.123 },
                zoom: 12
            });
            log('Map initialized');
            
            // Load data
            if (typeof DynamoDBService !== 'undefined') {
                const service = new DynamoDBService(window.DYNAMODB_API_ENDPOINT);
                service.fetchLocations({ limit: 10 }).then(locations => {
                    log(`Loaded ${locations.length} locations`);
                    locations.forEach(loc => {
                        log(`Creating marker: ${loc.captureId} at ${loc.lat}, ${loc.lng}`);
                        const marker = new google.maps.Marker({
                            position: { lat: loc.lat, lng: loc.lng },
                            map: map,
                            title: loc.captureId
                        });
                        markers[loc.captureId] = marker;
                    });
                    log(`Created ${Object.keys(markers).length} markers`);
                    
                    // Fit bounds
                    if (locations.length > 0) {
                        const bounds = new google.maps.LatLngBounds();
                        locations.forEach(loc => bounds.extend({ lat: loc.lat, lng: loc.lng }));
                        map.fitBounds(bounds);
                        log('Map fitted to bounds');
                    }
                });
            } else {
                log('ERROR: DynamoDBService not loaded');
            }
        }
    </script>
</body>
</html>
