<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integrated Vehicular Vegetation Monitoring System | Senior Design</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <!-- DynamoDB Service -->
    <script src="dynamodb-service.js"></script>
    <!-- Config (API keys) -->
    <script src="config.js"></script>
    <!-- Google Maps API Configuration -->
    <script>
        // Try to load config.js, but handle if it doesn't exist
        (function() {
            const script = document.createElement('script');
            script.src = 'config.js';
            script.onload = function() {
                console.log('config.js loaded successfully');
            };
            script.onerror = function() {
                console.warn('config.js not found. This is expected on GitHub Pages - use GitHub Secrets.');
                // Set empty key - will show error message
                window.GOOGLE_MAPS_API_KEY = '';
            };
            document.head.appendChild(script);
        })();
    </script>
    <!-- Google Maps API -->
    <script>
        // Global map and markers variables - must be defined before API loads
        // These MUST be in global scope for Google Maps callback
        window.map = null;
        window.markers = {};
        window.infoWindows = {};
        window.pendingLocations = null; // Store locations if map isn't ready yet
        window.dynamoDBService = null; // DynamoDB service instance
        
        // Initialize DynamoDB Service - MUST be defined early for map initialization
        window.initDynamoDBService = function() {
            console.log('üîÑ initDynamoDBService called');
            console.log('   DynamoDBService available:', typeof DynamoDBService !== 'undefined');
            console.log('   DYNAMODB_API_ENDPOINT:', window.DYNAMODB_API_ENDPOINT);
            
            if (typeof DynamoDBService !== 'undefined' && window.DYNAMODB_API_ENDPOINT) {
                try {
                    window.dynamoDBService = new DynamoDBService(window.DYNAMODB_API_ENDPOINT);
                    dynamoDBService = window.dynamoDBService;
                    console.log('‚úÖ DynamoDB Service initialized successfully');
                    return true;
                } catch (error) {
                    console.error('‚ùå Error creating DynamoDBService:', error);
                    return false;
                }
            } else {
                if (typeof DynamoDBService === 'undefined') {
                    console.warn('‚ö†Ô∏è DynamoDBService class not loaded yet');
                }
                if (!window.DYNAMODB_API_ENDPOINT) {
                    console.warn('‚ö†Ô∏è DYNAMODB_API_ENDPOINT not configured');
                }
                return false;
            }
        };
        
        // Alias for easier access
        let map = window.map;
        let markers = window.markers;
        let infoWindows = window.infoWindows;
        let pendingLocations = window.pendingLocations;
        let dynamoDBService = window.dynamoDBService;
        // vehicleData is now loaded from DynamoDB - see loadLocations() function

        // Show map error message
        window.showMapError = function(message) {
            const mapContainer = document.getElementById('mapContainer');
            if (mapContainer) {
                mapContainer.innerHTML = `
                    <div class="absolute inset-0 flex items-center justify-center bg-infra-900">
                        <div class="text-center p-8">
                            <i data-lucide="alert-circle" class="h-16 w-16 text-red-500 mx-auto mb-4"></i>
                            <p class="text-red-400 text-lg font-semibold mb-2">Google Maps API Error</p>
                            <p class="text-infra-300 text-sm mb-4">${message}</p>
                            <div class="text-left text-xs text-infra-400 bg-infra-800 p-4 rounded-lg max-w-md mx-auto">
                                <p class="font-semibold mb-2">Common fixes:</p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>Enable "Maps JavaScript API" in Google Cloud Console</li>
                                    <li>Check API key restrictions (allow localhost or file://)</li>
                                    <li>Verify billing is enabled (free tier available)</li>
                                    <li>Check browser console (F12) for detailed errors</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            }
        };

        // Initialize Google Map - must be global for callback
        window.initMap = function() {
            // Wait for DOM to be ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    initializeMap();
                });
            } else {
                initializeMap();
            }
        };

        function initializeMap() {
            console.log('initializeMap called');
            // Check if Google Maps is available
            if (typeof google === 'undefined' || !google.maps) {
                console.error('Google Maps API not loaded');
                showMapError('Google Maps API failed to load. Please check your API key and ensure Maps JavaScript API is enabled.');
                return;
            }

            const mapContainer = document.getElementById('mapContainer');
            if (!mapContainer) {
                console.error('Map container not found, retrying...');
                // Retry after a short delay
                setTimeout(initializeMap, 100);
                return;
            }

            console.log('Map container found, initializing map...');

            // Default center (will be updated when data loads)
            // Using approximate center of test data area
            const center = { lat: 38.922, lng: -83.123 };
            
            try {
                // Clear any placeholder content
                mapContainer.innerHTML = '';
                
                // Ensure container is visible
                mapContainer.style.minHeight = '600px';
                mapContainer.style.width = '100%';
                mapContainer.style.position = 'relative';
                
                // Create map with dark theme
                // Center will be updated when data loads
                window.map = new google.maps.Map(mapContainer, {
                    center: center,
                    zoom: 12,
                    styles: [
                        // Base geometry
                        { elementType: 'geometry', stylers: [{ color: '#1e293b' }] },
                        { elementType: 'labels.text.stroke', stylers: [{ color: '#1e293b' }] },
                        { elementType: 'labels.text.fill', stylers: [{ color: '#cbd5e1' }] },
                        
                        // Hide all POI (points of interest like stores, restaurants, etc.)
                        {
                            featureType: 'poi',
                            stylers: [{ visibility: 'off' }]
                        },
                        {
                            featureType: 'poi.business',
                            stylers: [{ visibility: 'off' }]
                        },
                        {
                            featureType: 'poi.attraction',
                            stylers: [{ visibility: 'off' }]
                        },
                        {
                            featureType: 'poi.place_of_worship',
                            stylers: [{ visibility: 'off' }]
                        },
                        {
                            featureType: 'poi.school',
                            stylers: [{ visibility: 'off' }]
                        },
                        {
                            featureType: 'poi.sports_complex',
                            stylers: [{ visibility: 'off' }]
                        },
                        
                        // Administrative boundaries (cities, states, counties)
                        {
                            featureType: 'administrative',
                            elementType: 'geometry.stroke',
                            stylers: [{ color: '#475569' }, { visibility: 'on' }]
                        },
                        {
                            featureType: 'administrative',
                            elementType: 'labels.text.fill',
                            stylers: [{ color: '#94a3b8' }, { visibility: 'on' }]
                        },
                        {
                            featureType: 'administrative.locality',
                            elementType: 'labels.text.fill',
                            stylers: [{ color: '#cbd5e1' }, { visibility: 'on' }]
                        },
                        {
                            featureType: 'administrative.neighborhood',
                            elementType: 'labels.text.fill',
                            stylers: [{ color: '#94a3b8' }, { visibility: 'on' }]
                        },
                        {
                            featureType: 'administrative.land_parcel',
                            elementType: 'labels.text.fill',
                            stylers: [{ color: '#64748b' }, { visibility: 'simplified' }]
                        },
                        
                        // Landscape (keep natural features)
                        {
                            featureType: 'landscape',
                            elementType: 'geometry',
                            stylers: [{ color: '#0f172a' }]
                        },
                        {
                            featureType: 'landscape.natural',
                            elementType: 'geometry',
                            stylers: [{ color: '#1e293b' }]
                        },
                        
                        // Roads (essential - keep visible)
                        {
                            featureType: 'road',
                            elementType: 'geometry',
                            stylers: [{ color: '#334155' }]
                        },
                        {
                            featureType: 'road',
                            elementType: 'geometry.stroke',
                            stylers: [{ color: '#475569' }]
                        },
                        {
                            featureType: 'road',
                            elementType: 'labels.text.fill',
                            stylers: [{ color: '#94a3b8' }]
                        },
                        {
                            featureType: 'road.highway',
                            elementType: 'geometry',
                            stylers: [{ color: '#475569' }]
                        },
                        {
                            featureType: 'road.highway',
                            elementType: 'geometry.stroke',
                            stylers: [{ color: '#64748b' }]
                        },
                        {
                            featureType: 'road.highway',
                            elementType: 'labels.text.fill',
                            stylers: [{ color: '#cbd5e1' }]
                        },
                        {
                            featureType: 'road.arterial',
                            elementType: 'geometry',
                            stylers: [{ color: '#334155' }]
                        },
                        {
                            featureType: 'road.local',
                            elementType: 'geometry',
                            stylers: [{ color: '#1e293b' }]
                        },
                        
                        // Transit (hide public transit stations)
                        {
                            featureType: 'transit',
                            stylers: [{ visibility: 'off' }]
                        },
                        {
                            featureType: 'transit.station',
                            stylers: [{ visibility: 'off' }]
                        },
                        
                        // Water (keep visible)
                        {
                            featureType: 'water',
                            elementType: 'geometry',
                            stylers: [{ color: '#0c4a6e' }]
                        },
                        {
                            featureType: 'water',
                            elementType: 'labels.text.fill',
                            stylers: [{ color: '#64748b' }]
                        }
                    ],
                    mapTypeControl: false,
                    streetViewControl: false,
                    fullscreenControl: true
                });

                // Update local references
                map = window.map;
                markers = window.markers;
                infoWindows = window.infoWindows;

                console.log('‚úÖ Google Maps initialized successfully');
                
                // Simple function to load data and create markers (like test-map-debug.html)
                // Make it accessible globally
                window.loadDataAndCreateMarkers = function() {
                    console.log('üîÑ loadDataAndCreateMarkers called');
                    console.log('   DynamoDBService available:', typeof DynamoDBService !== 'undefined');
                    console.log('   DYNAMODB_API_ENDPOINT:', window.DYNAMODB_API_ENDPOINT);
                    console.log('   Map available:', !!map);
                    
                    if (typeof DynamoDBService === 'undefined') {
                        console.warn('‚ö†Ô∏è DynamoDBService not loaded yet, retrying in 500ms...');
                        setTimeout(window.loadDataAndCreateMarkers, 500);
                        return;
                    }
                    
                    if (!window.DYNAMODB_API_ENDPOINT) {
                        console.error('‚ùå DYNAMODB_API_ENDPOINT not configured');
                        const listContainer = document.getElementById('detectionsList');
                        if (listContainer) {
                            listContainer.innerHTML = `
                                <div class="text-center text-red-400 text-sm py-8">
                                    <i data-lucide="alert-circle" class="h-6 w-6 mx-auto mb-2"></i>
                                    <p>API endpoint not configured</p>
                                    <p class="text-xs mt-2 text-infra-400">Check config.js</p>
                                </div>
                            `;
                            if (typeof lucide !== 'undefined') lucide.createIcons();
                        }
                        return;
                    }
                    
                    if (!map) {
                        console.error('‚ùå Map not available');
                        return;
                    }
                    
                    console.log('üîÑ Creating DynamoDB service and fetching data...');
                    const service = new DynamoDBService(window.DYNAMODB_API_ENDPOINT);
                    
                    service.fetchLocations({ limit: 100 }).then(locations => {
                        console.log(`‚úÖ Loaded ${locations.length} locations from API`);
                        
                        // Check if using mock data
                        const isUsingMock = service.isUsingMockData();
                        const lastError = service.getLastError();
                        if (typeof showMockDataWarning === 'function') {
                            showMockDataWarning(isUsingMock, lastError);
                        } else if (typeof window.showMockDataWarning === 'function') {
                            window.showMockDataWarning(isUsingMock, lastError);
                        } else {
                            console.warn('showMockDataWarning function not available');
                        }
                        
                        // Store in map for quick lookup
                        window.vehicleDataMap = {};
                        vehicleDataMap = window.vehicleDataMap;
                        locations.forEach(loc => {
                            window.vehicleDataMap[loc.captureId] = loc;
                            vehicleDataMap[loc.captureId] = loc;
                        });
                        
                        // Update sidebar
                        if (typeof window.updateDetectionsList === 'function') {
                            window.updateDetectionsList(locations);
                        } else if (typeof updateDetectionsList === 'function') {
                            updateDetectionsList(locations);
                        } else {
                            console.error('‚ùå updateDetectionsList function not available');
                        }
                        
                        // Clear existing markers
                        Object.values(markers).forEach(marker => {
                            if (marker && marker.setMap) {
                                marker.setMap(null);
                            }
                        });
                        Object.values(infoWindows).forEach(iw => {
                            if (iw && iw.close) {
                                iw.close();
                            }
                        });
                        markers = {};
                        infoWindows = {};
                        window.markers = markers;
                        window.infoWindows = infoWindows;
                        
                        // Create markers (like test-map-debug.html but with colored circles)
                        locations.forEach(loc => {
                            if (!loc.lat || !loc.lng || isNaN(loc.lat) || isNaN(loc.lng)) {
                                console.warn(`‚ö†Ô∏è Invalid coordinates for ${loc.captureId}`);
                                return;
                            }
                            
                            // Create custom colored circle marker based on risk level
                    const markerIcon = {
                        path: google.maps.SymbolPath.CIRCLE,
                        scale: 10,
                                fillColor: loc.bgColor || '#dc2626',
                        fillOpacity: 1,
                        strokeColor: '#ffffff',
                        strokeWeight: 2
                    };

                    const marker = new google.maps.Marker({
                                position: { lat: parseFloat(loc.lat), lng: parseFloat(loc.lng) },
                        map: map,
                                title: `${loc.deviceName || loc.captureId} - ${loc.risk} Risk`,
                        icon: markerIcon,
                        animation: google.maps.Animation.DROP
                    });

                    const infoWindow = new google.maps.InfoWindow({
                        content: `
                            <div style="font-family: 'Inter', sans-serif; min-width: 200px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                            <h3 style="margin: 0; font-weight: 600; font-size: 14px; color: #0f172a;">${loc.deviceName || loc.captureId}</h3>
                                            <span style="background-color: ${loc.bgColor}20; color: ${loc.bgColor}; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">${loc.risk}</span>
                                </div>
                                <div style="font-size: 12px; color: #475569; line-height: 1.6;">
                                            <div><strong>Location:</strong> ${loc.location}</div>
                                            <div><strong>Class:</strong> ${loc.species}</div>
                                            <div><strong>Confidence:</strong> ${(loc.confidence * 100).toFixed(1)}%</div>
                                            <div><strong>Time:</strong> ${loc.timestamp}</div>
                                </div>
                            </div>
                        `
                    });

                    marker.addListener('click', () => {
                                Object.values(infoWindows).forEach(iw => {
                                    if (iw && iw.close) iw.close();
                                });
                        infoWindow.open(map, marker);
                                selectVehicle(loc.captureId);
                            });

                            markers[loc.captureId] = marker;
                            infoWindows[loc.captureId] = infoWindow;
                        });
                        
                        console.log(`‚úÖ Created ${Object.keys(markers).length} markers on map`);
                        
                        // Center map on markers
                        if (locations.length > 0) {
                            const bounds = new google.maps.LatLngBounds();
                            locations.forEach(loc => {
                                if (loc.lat && loc.lng && !isNaN(loc.lat) && !isNaN(loc.lng)) {
                                    bounds.extend({ lat: loc.lat, lng: loc.lng });
                                }
                            });
                            if (!bounds.isEmpty()) {
                                map.fitBounds(bounds);
                                console.log('‚úÖ Map centered on markers');
                            }
                        }
                        
                        if (isUsingMock) {
                            console.warn(`‚ö†Ô∏è Using mock data (${locations.length} items). API error: ${lastError || 'Unknown'}`);
                        } else {
                            console.log(`‚úÖ Successfully loaded and displayed ${locations.length} locations`);
                        }
                    }).catch(error => {
                        console.error('‚ùå Error fetching locations:', error);
                        if (typeof window.showMockDataWarning === 'function') {
                            window.showMockDataWarning(true, error.message);
                        } else if (typeof showMockDataWarning === 'function') {
                            showMockDataWarning(true, error.message);
                        } else {
                            console.warn('‚ö†Ô∏è showMockDataWarning function not available');
                        }
                        
                        // Show error in sidebar
                        const listContainer = document.getElementById('detectionsList');
                        if (listContainer) {
                            listContainer.innerHTML = `
                                <div class="text-center text-red-400 text-sm py-8">
                                    <i data-lucide="alert-circle" class="h-6 w-6 mx-auto mb-2"></i>
                                    <p class="font-semibold">Error loading detections</p>
                                    <p class="text-xs mt-2 text-infra-400">${error.message}</p>
                                    <button onclick="location.reload()" class="mt-4 px-4 py-2 bg-red-600 hover:bg-red-700 rounded text-white text-xs transition-colors">
                                        Retry
                                    </button>
                                </div>
                            `;
                            if (typeof lucide !== 'undefined') {
                                lucide.createIcons();
                            }
                        }
                    });
                };
                
                // Simple approach: Load data directly after map is ready (like test-map-debug.html)
                // Wait for map tiles to load, then fetch and display data
                google.maps.event.addListenerOnce(map, 'tilesloaded', function() {
                    console.log('‚úÖ Map tiles loaded, loading data...');
                    window.loadDataAndCreateMarkers();
                });
                
                // Fallback: if tilesloaded doesn't fire, try after delay
                setTimeout(function() {
                    const currentMarkers = window.markers || markers;
                    if (!currentMarkers || Object.keys(currentMarkers).length === 0) {
                        console.log('‚ö†Ô∏è Using fallback: loading data after delay');
                        if (typeof window.loadDataAndCreateMarkers === 'function') {
                            window.loadDataAndCreateMarkers();
                        } else {
                            console.error('‚ùå loadDataAndCreateMarkers function not available');
                        }
                    }
                }, 2000);
            } catch (error) {
                console.error('Error initializing map:', error);
                showMapError('Error initializing map: ' + error.message);
            }
        }
    </script>
    <script>
        // Load Google Maps API with key from config
        (function() {
            // Wait for config.js to load, with multiple attempts
            let attempts = 0;
            const maxAttempts = 20; // 2 seconds total (20 * 100ms)
            
            const checkAndLoad = function() {
                const apiKey = window.GOOGLE_MAPS_API_KEY || '';
                if (!apiKey || apiKey === 'YOUR_API_KEY_HERE' || apiKey === '') {
                    attempts++;
                    if (attempts < maxAttempts) {
                        // Keep trying - config.js might still be loading
                        setTimeout(checkAndLoad, 100);
                        return;
                    }
                    
                    // Max attempts reached - show error
                    console.error('Google Maps API key not configured after', attempts, 'attempts');
                    const showError = function() {
                        const mapContainer = document.getElementById('mapContainer');
                        if (mapContainer) {
                            mapContainer.innerHTML = `
                                <div class="absolute inset-0 flex items-center justify-center bg-infra-900">
                                    <div class="text-center p-8 max-w-md">
                                        <i data-lucide="alert-circle" class="h-16 w-16 text-red-500 mx-auto mb-4"></i>
                                        <p class="text-red-400 text-lg font-semibold mb-2">API Key Not Configured</p>
                                        <p class="text-infra-300 text-sm mb-4">Please create config.js with your Google Maps API key</p>
                                        <div class="text-left text-xs text-infra-400 bg-infra-800 p-4 rounded-lg mt-4">
                                            <p class="font-semibold mb-2 text-white">For GitHub Pages:</p>
                                            <ol class="list-decimal list-inside space-y-1">
                                                <li>Go to repo Settings > Secrets > Actions</li>
                                                <li>Add secret: GOOGLE_MAPS_API_KEY</li>
                                                <li>Push to trigger workflow</li>
                                            </ol>
                                            <p class="font-semibold mb-2 text-white mt-3">Or manually:</p>
                                            <p>Create config.js: <code class="bg-infra-900 px-2 py-1 rounded">window.GOOGLE_MAPS_API_KEY = 'YOUR_KEY';</code></p>
                                        </div>
                                    </div>
                                </div>
                            `;
                            if (typeof lucide !== 'undefined') {
                                lucide.createIcons();
                            }
                        }
                    };
                    
                    // Try immediately and also on load
                    showError();
                    window.addEventListener('load', showError);
                } else {
                    // API key found - load Google Maps
                    console.log('API key found, loading Google Maps API...');
                    const script = document.createElement('script');
                    script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&callback=initMap`;
                    script.async = true;
                    script.defer = true;
                    script.onload = function() {
                        console.log('Google Maps API script loaded successfully');
                    };
                    script.onerror = function() {
                        console.error('Failed to load Google Maps API');
                        const mapContainer = document.getElementById('mapContainer');
                        if (mapContainer) {
                            mapContainer.innerHTML = `
                                <div class="absolute inset-0 flex items-center justify-center bg-infra-900">
                                    <div class="text-center p-8">
                                        <i data-lucide="alert-circle" class="h-16 w-16 text-red-500 mx-auto mb-4"></i>
                                        <p class="text-red-400 text-lg font-semibold mb-2">Failed to Load Google Maps</p>
                                        <p class="text-infra-300 text-sm">Please check your API key and restrictions</p>
                                    </div>
                                </div>
                            `;
                            if (typeof lucide !== 'undefined') {
                                lucide.createIcons();
                            }
                        }
                    };
                    document.head.appendChild(script);
                }
            };
            
            // Start checking after a short delay
            setTimeout(checkAndLoad, 50);
        })();
    </script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        utility: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                        veg: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            500: '#22c55e',
                            600: '#16a34a',
                            800: '#166534',
                            900: '#14532d',
                        },
                        infra: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            600: '#475569',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-hero {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(20, 83, 45, 0.85) 100%),
                        url('https://images.unsplash.com/photo-1449824913935-59a10b8d2000?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80') center/cover;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .timeline-line {
            background: linear-gradient(to bottom, #16a34a, #0ea5e9);
        }
        .map-grid {
            background-image: 
                linear-gradient(rgba(203, 213, 225, 0.3) 1px, transparent 1px),
                linear-gradient(90deg, rgba(203, 213, 225, 0.3) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .severity-high { background-color: #dc2626; }
        .severity-medium { background-color: #ea580c; }
        .severity-low { background-color: #16a34a; }
    </style>
</head>
<body class="font-sans text-infra-800 bg-infra-50 antialiased">

    <!-- Navigation -->
    <nav class="fixed w-full z-50 glass-panel border-b border-infra-200 transition-all duration-300" id="navbar">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center gap-2">
                    <i data-lucide="cpu" class="h-6 w-6 text-veg-600"></i>
                    <span class="font-bold text-lg tracking-tight text-infra-900">IVVM<span class="text-veg-600">System</span></span>
                </div>
                
                <!-- Desktop Menu -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="#overview" class="text-sm font-medium text-infra-600 hover:text-veg-600 transition-colors">Overview</a>
                    <a href="#architecture" class="text-sm font-medium text-infra-600 hover:text-veg-600 transition-colors">Architecture</a>
                    <a href="#dashboard" class="text-sm font-medium text-infra-600 hover:text-veg-600 transition-colors">Dashboard</a>
                    <a href="#engineering" class="text-sm font-medium text-infra-600 hover:text-veg-600 transition-colors">Engineering</a>
                    <a href="#status" class="text-sm font-medium text-infra-600 hover:text-veg-600 transition-colors">Status</a>
                    <a href="#impact" class="text-sm font-medium text-infra-600 hover:text-veg-600 transition-colors">Impact</a>
                    <a href="#team" class="text-sm font-medium text-infra-600 hover:text-veg-600 transition-colors">Team</a>
                </div>

                <div class="hidden md:flex items-center gap-4">
                    <span class="text-xs font-mono text-utility-600 bg-utility-50 px-2 py-1 rounded">v2.4.0-beta</span>
                    <a href="#dashboard" class="bg-veg-600 hover:bg-veg-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors flex items-center gap-2">
                        <i data-lucide="map" class="h-4 w-4"></i>
                        View Dashboard
                    </a>
                </div>

                <!-- Mobile menu button -->
                <button class="md:hidden p-2 rounded-md text-infra-600 hover:bg-infra-100" onclick="toggleMobileMenu()">
                    <i data-lucide="menu" class="h-6 w-6" id="menuIcon"></i>
                </button>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div class="md:hidden hidden bg-white border-t border-infra-200" id="mobileMenu">
            <div class="px-4 pt-2 pb-3 space-y-1">
                <a href="#overview" class="block px-3 py-2 text-base font-medium text-infra-600 hover:text-veg-600 hover:bg-infra-50 rounded-md">Overview</a>
                <a href="#architecture" class="block px-3 py-2 text-base font-medium text-infra-600 hover:text-veg-600 hover:bg-infra-50 rounded-md">Architecture</a>
                <a href="#dashboard" class="block px-3 py-2 text-base font-medium text-infra-600 hover:text-veg-600 hover:bg-infra-50 rounded-md">Dashboard</a>
                <a href="#engineering" class="block px-3 py-2 text-base font-medium text-infra-600 hover:text-veg-600 hover:bg-infra-50 rounded-md">Engineering</a>
                <a href="#status" class="block px-3 py-2 text-base font-medium text-infra-600 hover:text-veg-600 hover:bg-infra-50 rounded-md">Status</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="relative h-screen flex items-center justify-center gradient-hero overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-b from-transparent to-infra-900/50"></div>
        
        <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/10 backdrop-blur-sm border border-white/20 text-white text-sm font-medium mb-6 animate-fade-in-up">
                <i data-lucide="award" class="h-4 w-4 text-veg-400"></i>
                Senior Design Engineering Project 2024-2025
            </div>
            
            <h1 class="text-4xl md:text-6xl lg:text-7xl font-bold text-white tracking-tight mb-6 leading-tight">
                Integrated Vehicular<br>
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-veg-400 to-utility-400">Vegetation Monitor</span>
            </h1>
            
            <p class="text-xl md:text-2xl text-infra-100 max-w-3xl mx-auto mb-8 font-light">
                Automated geotagged roadside vegetation analysis for utility infrastructure protection during routine vehicle operations.
            </p>
            
            <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
                <a href="#architecture" class="px-8 py-4 bg-veg-600 hover:bg-veg-700 text-white rounded-lg font-semibold transition-all flex items-center gap-2 shadow-lg shadow-veg-600/30">
                    <i data-lucide="layers" class="h-5 w-5"></i>
                    View System Overview
                </a>
                <a href="#dashboard" class="px-8 py-4 bg-white/10 hover:bg-white/20 backdrop-blur-sm text-white border border-white/30 rounded-lg font-semibold transition-all flex items-center gap-2">
                    <i data-lucide="layout-dashboard" class="h-5 w-5"></i>
                    View Dashboard
                </a>
            </div>

            <div class="mt-16 grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto text-left">
                <div class="glass-panel p-6 rounded-xl">
                    <i data-lucide="satellite" class="h-8 w-8 text-utility-400 mb-3"></i>
                    <h3 class="text-white font-semibold mb-1">GPS-Integrated</h3>
                    <p class="text-infra-200 text-sm">Real-time geotagging with sub-meter accuracy</p>
                </div>
                <div class="glass-panel p-6 rounded-xl">
                    <i data-lucide="camera" class="h-8 w-8 text-veg-400 mb-3"></i>
                    <h3 class="text-white font-semibold mb-1">AI-Powered</h3>
                    <p class="text-infra-200 text-sm">Automated vegetation severity classification</p>
                </div>
                <div class="glass-panel p-6 rounded-xl">
                    <i data-lucide="wifi" class="h-8 w-8 text-utility-400 mb-3"></i>
                    <h3 class="text-white font-semibold mb-1">Cloud-Connected</h3>
                    <p class="text-infra-200 text-sm">Wireless data transmission to central analytics</p>
                </div>
            </div>
        </div>

        <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 animate-bounce">
            <i data-lucide="chevron-down" class="h-6 w-6 text-white/70"></i>
        </div>
    </section>

    <!-- Project Overview -->
    <section id="overview" class="py-24 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-4xl font-bold text-infra-900 mb-4">Project Overview</h2>
                <div class="w-24 h-1 bg-gradient-to-r from-veg-500 to-utility-500 mx-auto rounded-full"></div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center mb-16">
                <div class="bg-red-50 border-l-4 border-red-400 p-8 rounded-r-lg">
                    <div class="flex items-center gap-3 mb-4">
                        <i data-lucide="alert-triangle" class="h-6 w-6 text-red-600"></i>
                        <h3 class="text-xl font-bold text-red-900">The Problem</h3>
                    </div>
                    <p class="text-red-800 mb-4 leading-relaxed">
                        Utility companies currently rely on manual inspections or costly helicopter surveys to monitor vegetation encroachment on transmission lines. These methods are labor-intensive, expensive ($500-$1,200 per mile), and reactive rather than preventative.
                    </p>
                    <ul class="space-y-2 text-red-700 text-sm">
                        <li class="flex items-start gap-2">
                            <i data-lucide="x-circle" class="h-4 w-4 mt-0.5 flex-shrink-0"></i>
                            <span>Vegetation-related outages cost utilities $1.2B annually</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i data-lucide="x-circle" class="h-4 w-4 mt-0.5 flex-shrink-0"></i>
                            <span>Manual inspections limited by terrain and weather</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i data-lucide="x-circle" class="h-4 w-4 mt-0.5 flex-shrink-0"></i>
                            <span>Reactive maintenance increases wildfire risk</span>
                        </li>
                    </ul>
                </div>

                <div class="bg-veg-50 border-l-4 border-veg-500 p-8 rounded-r-lg">
                    <div class="flex items-center gap-3 mb-4">
                        <i data-lucide="check-circle" class="h-6 w-6 text-veg-600"></i>
                        <h3 class="text-xl font-bold text-veg-900">Our Solution</h3>
                    </div>
                    <p class="text-veg-800 mb-4 leading-relaxed">
                        An automated vehicle-mounted monitoring system that captures geotagged imagery during routine operations, processes data through AI cloud analytics, and provides real-time vegetation risk mapping.
                    </p>
                    <ul class="space-y-2 text-veg-700 text-sm">
                        <li class="flex items-start gap-2">
                            <i data-lucide="check" class="h-4 w-4 mt-0.5 flex-shrink-0"></i>
                            <span>Scalable: Convert existing fleet vehicles to data collectors</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i data-lucide="check" class="h-4 w-4 mt-0.5 flex-shrink-0"></i>
                            <span>Automated: Zero human intervention during data capture</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i data-lucide="check" class="h-4 w-4 mt-0.5 flex-shrink-0"></i>
                            <span>Preventative: Predictive analytics for maintenance scheduling</span>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="text-center p-6 rounded-xl bg-infra-50 border border-infra-200">
                    <div class="w-12 h-12 mx-auto bg-utility-100 rounded-lg flex items-center justify-center mb-4">
                        <i data-lucide="scale" class="h-6 w-6 text-utility-600"></i>
                    </div>
                    <h4 class="font-semibold text-infra-900 mb-2">Scalable</h4>
                    <p class="text-sm text-infra-600">Fleet-wide deployment without dedicated inspection vehicles</p>
                </div>
                <div class="text-center p-6 rounded-xl bg-infra-50 border border-infra-200">
                    <div class="w-12 h-12 mx-auto bg-veg-100 rounded-lg flex items-center justify-center mb-4">
                        <i data-lucide="bot" class="h-6 w-6 text-veg-600"></i>
                    </div>
                    <h4 class="font-semibold text-infra-900 mb-2">Automated</h4>
                    <p class="text-sm text-infra-600">24/7 operation during normal fleet activities</p>
                </div>
                <div class="text-center p-6 rounded-xl bg-infra-50 border border-infra-200">
                    <div class="w-12 h-12 mx-auto bg-utility-100 rounded-lg flex items-center justify-center mb-4">
                        <i data-lucide="piggy-bank" class="h-6 w-6 text-utility-600"></i>
                    </div>
                    <h4 class="font-semibold text-infra-900 mb-2">Cost-Effective</h4>
                    <p class="text-sm text-infra-600">75% reduction in inspection costs per mile</p>
                </div>
                <div class="text-center p-6 rounded-xl bg-infra-50 border border-infra-200">
                    <div class="w-12 h-12 mx-auto bg-veg-100 rounded-lg flex items-center justify-center mb-4">
                        <i data-lucide="shield-check" class="h-6 w-6 text-veg-600"></i>
                    </div>
                    <h4 class="font-semibold text-infra-900 mb-2">Preventative</h4>
                    <p class="text-sm text-infra-600">Proactive risk mitigation before outages occur</p>
                </div>
            </div>
        </div>
    </section>

    <!-- System Architecture -->
    <section id="architecture" class="py-24 bg-infra-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-4xl font-bold text-infra-900 mb-4">System Architecture</h2>
                <p class="text-lg text-infra-600 max-w-2xl mx-auto">
                    End-to-end workflow from vehicle-mounted data capture to cloud-based AI analytics and utility dashboard integration.
                </p>
            </div>

            <!-- Workflow Diagram -->
            <div class="mb-16 overflow-x-auto">
                <div class="flex items-center justify-between min-w-max px-4 gap-4">
                    <div class="flex flex-col items-center w-48">
                        <div class="w-16 h-16 bg-utility-600 rounded-full flex items-center justify-center text-white shadow-lg mb-3">
                            <i data-lucide="truck" class="h-8 w-8"></i>
                        </div>
                        <h4 class="font-semibold text-infra-900 text-center">Fleet Vehicle</h4>
                        <p class="text-xs text-infra-500 text-center mt-1">Data Collection Unit</p>
                    </div>
                    <div class="flex-1 h-1 bg-gradient-to-r from-utility-500 to-veg-500 rounded"></div>
                    <div class="flex flex-col items-center w-48">
                        <div class="w-16 h-16 bg-veg-600 rounded-full flex items-center justify-center text-white shadow-lg mb-3">
                            <i data-lucide="gps" class="h-8 w-8"></i>
                        </div>
                        <h4 class="font-semibold text-infra-900 text-center">GPS Integration</h4>
                        <p class="text-xs text-infra-500 text-center mt-1">Geotagging & Sync</p>
                    </div>
                    <div class="flex-1 h-1 bg-gradient-to-r from-veg-500 to-utility-500 rounded"></div>
                    <div class="flex flex-col items-center w-48">
                        <div class="w-16 h-16 bg-utility-600 rounded-full flex items-center justify-center text-white shadow-lg mb-3">
                            <i data-lucide="upload-cloud" class="h-8 w-8"></i>
                        </div>
                        <h4 class="font-semibold text-infra-900 text-center">Wireless TX</h4>
                        <p class="text-xs text-infra-500 text-center mt-1">4G/5G Upload</p>
                    </div>
                    <div class="flex-1 h-1 bg-gradient-to-r from-utility-500 to-veg-500 rounded"></div>
                    <div class="flex flex-col items-center w-48">
                        <div class="w-16 h-16 bg-veg-600 rounded-full flex items-center justify-center text-white shadow-lg mb-3">
                            <i data-lucide="server" class="h-8 w-8"></i>
                        </div>
                        <h4 class="font-semibold text-infra-900 text-center">Cloud AI</h4>
                        <p class="text-xs text-infra-500 text-center mt-1">Processing & Analysis</p>
                    </div>
                    <div class="flex-1 h-1 bg-gradient-to-r from-veg-500 to-utility-500 rounded"></div>
                    <div class="flex flex-col items-center w-48">
                        <div class="w-16 h-16 bg-utility-600 rounded-full flex items-center justify-center text-white shadow-lg mb-3">
                            <i data-lucide="layout-dashboard" class="h-8 w-8"></i>
                        </div>
                        <h4 class="font-semibold text-infra-900 text-center">Dashboard</h4>
                        <p class="text-xs text-infra-500 text-center mt-1">Visualization & Alerts</p>
                    </div>
                </div>
            </div>

            <!-- Component Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-white rounded-xl shadow-sm border border-infra-200 p-8">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-10 h-10 bg-utility-100 rounded-lg flex items-center justify-center">
                            <i data-lucide="hard-drive" class="h-5 w-5 text-utility-600"></i>
                        </div>
                        <h3 class="text-xl font-bold text-infra-900">Hardware Components</h3>
                    </div>
                    <div class="space-y-4">
                        <div class="flex items-start gap-4 p-4 bg-infra-50 rounded-lg border border-infra-100">
                            <i data-lucide="camera" class="h-5 w-5 text-utility-600 mt-0.5"></i>
                            <div>
                                <h4 class="font-semibold text-infra-900">Stereoscopic Camera Array</h4>
                                <p class="text-sm text-infra-600">Dual 4K industrial cameras with depth sensing capability for vegetation proximity analysis.</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-4 p-4 bg-infra-50 rounded-lg border border-infra-100">
                            <i data-lucide="navigation" class="h-5 w-5 text-utility-600 mt-0.5"></i>
                            <div>
                                <h4 class="font-semibold text-infra-900">RTK-GPS Module</h4>
                                <p class="text-sm text-infra-600">Real-time kinematic positioning providing ¬±2cm location accuracy for precise asset mapping.</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-4 p-4 bg-infra-50 rounded-lg border border-infra-100">
                            <i data-lucide="battery" class="h-5 w-5 text-utility-600 mt-0.5"></i>
                            <div>
                                <h4 class="font-semibold text-infra-900">Power Management Unit</h4>
                                <p class="text-sm text-infra-600">Automotive-grade voltage regulation with vibration-resistant solid-state design.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-infra-200 p-8">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-10 h-10 bg-veg-100 rounded-lg flex items-center justify-center">
                            <i data-lucide="code" class="h-5 w-5 text-veg-600"></i>
                        </div>
                        <h3 class="text-xl font-bold text-infra-900">Software Stack</h3>
                    </div>
                    <div class="space-y-4">
                        <div class="flex items-start gap-4 p-4 bg-infra-50 rounded-lg border border-infra-100">
                            <i data-lucide="brain" class="h-5 w-5 text-veg-600 mt-0.5"></i>
                            <div>
                                <h4 class="font-semibold text-infra-900">Computer Vision Engine</h4>
                                <p class="text-sm text-infra-600">YOLOv8-based vegetation detection with custom-trained models for utility-specific species.</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-4 p-4 bg-infra-50 rounded-lg border border-infra-100">
                            <i data-lucide="database" class="h-5 w-5 text-veg-600 mt-0.5"></i>
                            <div>
                                <h4 class="font-semibold text-infra-900">Geospatial Database</h4>
                                <p class="text-sm text-infra-600">PostgreSQL/PostGIS backend with time-series data retention for trend analysis.</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-4 p-4 bg-infra-50 rounded-lg border border-infra-100">
                            <i data-lucide="globe" class="h-5 w-5 text-veg-600 mt-0.5"></i>
                            <div>
                                <h4 class="font-semibold text-infra-900">Web Dashboard</h4>
                                <p class="text-sm text-infra-600">React-based frontend with Mapbox GL integration for interactive asset visualization.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Interactive Dashboard -->
    <section id="dashboard" class="py-24 bg-infra-900 text-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-8">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div>
                    <h2 class="text-3xl font-bold mb-2">Live Monitoring Dashboard</h2>
                    <p class="text-infra-300">Real-time vegetation analysis from active fleet vehicles</p>
                </div>
                <div class="flex items-center gap-3">
                    <span class="flex items-center gap-2 text-sm">
                        <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                        System Online
                    </span>
                    <span class="font-mono text-sm bg-infra-800 px-3 py-1 rounded">Fleet: 12 Active</span>
                </div>
            </div>
        </div>

        <!-- Dashboard Interface -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="bg-infra-800 rounded-xl overflow-hidden border border-infra-700 shadow-2xl">
                <div class="flex flex-col lg:flex-row h-[600px]">
                    <!-- Map Area -->
                    <div class="flex-1 relative bg-infra-900" id="mapContainer" style="min-height: 600px;">
                        <!-- Google Map will be rendered here -->
                        
                        <!-- Map Controls -->
                        <div class="absolute bottom-4 left-4 z-10 flex gap-2">
                            <button class="bg-white/10 backdrop-blur-sm p-2 rounded hover:bg-white/20 transition-colors text-white" onclick="zoomMap(1)">
                                <i data-lucide="plus" class="h-5 w-5"></i>
                            </button>
                            <button class="bg-white/10 backdrop-blur-sm p-2 rounded hover:bg-white/20 transition-colors text-white" onclick="zoomMap(-1)">
                                <i data-lucide="minus" class="h-5 w-5"></i>
                            </button>
                        </div>

                        <!-- Legend -->
                        <div class="absolute top-4 right-4 bg-black/80 backdrop-blur-sm p-4 rounded-lg border border-infra-700 text-xs">
                            <h4 class="font-semibold mb-3 text-white">Vegetation Severity</h4>
                            <div class="space-y-2">
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                    <span class="text-infra-300">High (> 3ft clearance)</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 bg-orange-500 rounded-full"></div>
                                    <span class="text-infra-300">Medium (1-3ft)</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                    <span class="text-infra-300">Low (< 1ft)</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sidebar -->
                    <div class="w-full lg:w-80 bg-infra-800 border-l border-infra-700 flex flex-col">
                        <div class="p-4 border-b border-infra-700">
                            <h3 class="font-semibold flex items-center gap-2">
                                <i data-lucide="activity" class="h-4 w-4 text-utility-400"></i>
                                Recent Detections
                            </h3>
                        </div>
                        <div class="flex-1 overflow-y-auto p-4 space-y-3" id="detectionsList">
                            <!-- DynamoDB data will be loaded here -->
                            <div class="text-center text-infra-400 text-sm py-8">
                                <i data-lucide="loader" class="h-6 w-6 mx-auto mb-2 animate-spin"></i>
                                <p>Loading detections...</p>
                            </div>
                        </div>
                        
                        <!-- Selected Vehicle Detail -->
                        <div class="p-4 border-t border-infra-700 bg-infra-900/50" id="vehicleDetail">
                            <p class="text-sm text-infra-400 text-center">Select a detection to view details</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Engineering Design -->
    <section id="engineering" class="py-24 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-4xl font-bold text-infra-900 mb-4">Engineering Design</h2>
                <p class="text-lg text-infra-600">Multi-disciplinary approach addressing mechanical, electrical, and software systems integration</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                <div class="bg-infra-50 rounded-xl p-6 border border-infra-200 hover:shadow-lg transition-all group">
                    <div class="w-12 h-12 bg-utility-100 rounded-lg flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                        <i data-lucide="cog" class="h-6 w-6 text-utility-600"></i>
                    </div>
                    <h3 class="font-bold text-infra-900 mb-2">Mechanical</h3>
                    <p class="text-sm text-infra-600 mb-4">Vibration-isolated mounting system with ingress protection (IP67) rated enclosure.</p>
                    <ul class="text-xs text-infra-500 space-y-1">
                        <li>‚Ä¢ Anti-vibration dampeners</li>
                        <li>‚Ä¢ Thermal management</li>
                        <li>‚Ä¢ Aerodynamic housing</li>
                    </ul>
                </div>

                <div class="bg-infra-50 rounded-xl p-6 border border-infra-200 hover:shadow-lg transition-all group">
                    <div class="w-12 h-12 bg-veg-100 rounded-lg flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                        <i data-lucide="zap" class="h-6 w-6 text-veg-600"></i>
                    </div>
                    <h3 class="font-bold text-infra-900 mb-2">Electrical</h3>
                    <p class="text-sm text-infra-600 mb-4">12V automotive power regulation with backup battery and surge protection.</p>
                    <ul class="text-xs text-infra-500 space-y-1">
                        <li>‚Ä¢ Voltage regulation</li>
                        <li>‚Ä¢ Power filtering</li>
                        <li>‚Ä¢ ESD protection</li>
                    </ul>
                </div>

                <div class="bg-infra-50 rounded-xl p-6 border border-infra-200 hover:shadow-lg transition-all group">
                    <div class="w-12 h-12 bg-utility-100 rounded-lg flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                        <i data-lucide="chip" class="h-6 w-6 text-utility-600"></i>
                    </div>
                    <h3 class="font-bold text-infra-900 mb-2">Computer</h3>
                    <p class="text-sm text-infra-600 mb-4">Edge computing with NVIDIA Jetson for real-time preprocessing.</p>
                    <ul class="text-xs text-infra-500 space-y-1">
                        <li>‚Ä¢ Edge AI processing</li>
                        <li>‚Ä¢ Data buffering</li>
                        <li>‚Ä¢ LTE connectivity</li>
                    </ul>
                </div>

                <div class="bg-infra-50 rounded-xl p-6 border border-infra-200 hover:shadow-lg transition-all group">
                    <div class="w-12 h-12 bg-veg-100 rounded-lg flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                        <i data-lucide="link" class="h-6 w-6 text-veg-600"></i>
                    </div>
                    <h3 class="font-bold text-infra-900 mb-2">Systems Integration</h3>
                    <p class="text-sm text-infra-600 mb-4">Unified control architecture ensuring subsystem interoperability.</p>
                    <ul class="text-xs text-infra-500 space-y-1">
                        <li>‚Ä¢ API gateway</li>
                        <li>‚Ä¢ Data pipeline</li>
                        <li>‚Ä¢ Fleet management</li>
                    </ul>
                </div>
            </div>

            <!-- Design Constraints -->
            <div class="bg-gradient-to-r from-infra-900 to-infra-800 rounded-2xl p-8 text-white">
                <h3 class="text-2xl font-bold mb-6 flex items-center gap-3">
                    <i data-lucide="alert-circle" class="h-6 w-6 text-utility-400"></i>
                    Design Constraints & Considerations
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="glass-panel p-4 rounded-lg">
                        <h4 class="font-semibold text-utility-300 mb-2 flex items-center gap-2">
                            <i data-lucide="battery-warning" class="h-4 w-4"></i>
                            Power
                        </h4>
                        <p class="text-sm text-infra-200">Limited to 50W continuous draw from vehicle 12V system. Sleep mode implementation for parked vehicles.</p>
                    </div>
                    <div class="glass-panel p-4 rounded-lg">
                        <h4 class="font-semibold text-veg-300 mb-2 flex items-center gap-2">
                            <i data-lucide="activity" class="h-4 w-4"></i>
                            Vibration
                        </h4>
                        <p class="text-sm text-infra-200">Must withstand 5g RMS random vibration per IEC 60721-3-5 3M3 class specifications.</p>
                    </div>
                    <div class="glass-panel p-4 rounded-lg">
                        <h4 class="font-semibold text-utility-300 mb-2 flex items-center gap-2">
                            <i data-lucide="wifi-off" class="h-4 w-4"></i>
                            Bandwidth
                        </h4>
                        <p class="text-sm text-infra-200">Edge compression required for rural areas with limited 4G coverage. Store-and-forward capability.</p>
                    </div>
                    <div class="glass-panel p-4 rounded-lg">
                        <h4 class="font-semibold text-veg-300 mb-2 flex items-center gap-2">
                            <i data-lucide="thermometer-sun" class="h-4 w-4"></i>
                            Environment
                        </h4>
                        <p class="text-sm text-infra-200">Operating range -20¬∞C to +60¬∞C. IP67 rated for Florida hurricane season deployment.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Project Status -->
    <section id="status" class="py-24 bg-infra-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-4xl font-bold text-infra-900 mb-4">Project Status</h2>
                <p class="text-lg text-infra-600">Current development phase and milestone tracking</p>
            </div>

            <div class="relative">
                <!-- Timeline Line -->
                <div class="hidden md:block absolute left-1/2 transform -translate-x-1/2 h-full w-1 timeline-line rounded-full"></div>

                <div class="space-y-12">
                    <!-- Phase 1 -->
                    <div class="relative flex items-center justify-center">
                        <div class="hidden md:block w-1/2 pr-8 text-right">
                            <h3 class="text-xl font-bold text-infra-900">Ideation & Requirements</h3>
                            <p class="text-infra-600 mt-2">Literature review, stakeholder interviews, and initial concept development with NextEra Energy engineering team.</p>
                        </div>
                        <div class="absolute left-1/2 transform -translate-x-1/2 w-8 h-8 bg-veg-500 rounded-full border-4 border-white shadow-lg z-10 flex items-center justify-center">
                            <i data-lucide="check" class="h-4 w-4 text-white"></i>
                        </div>
                        <div class="hidden md:block w-1/2 pl-8">
                            <span class="inline-block bg-veg-100 text-veg-800 px-3 py-1 rounded-full text-sm font-semibold">Complete</span>
                            <p class="text-sm text-infra-500 mt-1">Aug - Sep 2024</p>
                        </div>
                        <div class="md:hidden w-full pl-12 border-l-4 border-veg-500 ml-4 pb-8">
                            <h3 class="text-lg font-bold text-infra-900">Ideation & Requirements</h3>
                            <p class="text-sm text-infra-600 mt-1">Complete ‚Ä¢ Aug-Sep 2024</p>
                        </div>
                    </div>

                    <!-- Phase 2 -->
                    <div class="relative flex items-center justify-center">
                        <div class="hidden md:block w-1/2 pr-8 text-right">
                            <span class="inline-block bg-veg-100 text-veg-800 px-3 py-1 rounded-full text-sm font-semibold">Complete</span>
                            <p class="text-sm text-infra-500 mt-1">Sep - Oct 2024</p>
                        </div>
                        <div class="absolute left-1/2 transform -translate-x-1/2 w-8 h-8 bg-veg-500 rounded-full border-4 border-white shadow-lg z-10 flex items-center justify-center">
                            <i data-lucide="check" class="h-4 w-4 text-white"></i>
                        </div>
                        <div class="hidden md:block w-1/2 pl-8">
                            <h3 class="text-xl font-bold text-infra-900">Design Selection</h3>
                            <p class="text-infra-600 mt-2">Trade-off analysis, benchmarking, and finalization of technical specifications and component selection.</p>
                        </div>
                        <div class="md:hidden w-full pl-12 border-l-4 border-veg-500 ml-4 pb-8">
                            <h3 class="text-lg font-bold text-infra-900">Design Selection</h3>
                            <p class="text-sm text-infra-600 mt-1">Complete ‚Ä¢ Sep-Oct 2024</p>
                        </div>
                    </div>

                    <!-- Phase 3 -->
                    <div class="relative flex items-center justify-center">
                        <div class="hidden md:block w-1/2 pr-8 text-right">
                            <h3 class="text-xl font-bold text-infra-900">Prototyping</h3>
                            <p class="text-infra-600 mt-2">CAD modeling, 3D printing enclosures, PCB fabrication, and initial software algorithm development.</p>
                        </div>
                        <div class="absolute left-1/2 transform -translate-x-1/2 w-8 h-8 bg-utility-500 rounded-full border-4 border-white shadow-lg z-10 flex items-center justify-center">
                            <div class="w-2 h-2 bg-white rounded-full animate-pulse"></div>
                        </div>
                        <div class="hidden md:block w-1/2 pl-8">
                            <span class="inline-block bg-utility-100 text-utility-800 px-3 py-1 rounded-full text-sm font-semibold">In Progress</span>
                            <p class="text-sm text-infra-500 mt-1">Oct - Dec 2024</p>
                        </div>
                        <div class="md:hidden w-full pl-12 border-l-4 border-utility-500 ml-4 pb-8">
                            <h3 class="text-lg font-bold text-infra-900">Prototyping</h3>
                            <p class="text-sm text-infra-600 mt-1">In Progress ‚Ä¢ Oct-Dec 2024</p>
                        </div>
                    </div>

                    <!-- Phase 4 -->
                    <div class="relative flex items-center justify-center opacity-50">
                        <div class="hidden md:block w-1/2 pr-8 text-right">
                            <span class="inline-block bg-infra-200 text-infra-700 px-3 py-1 rounded-full text-sm font-semibold">Upcoming</span>
                            <p class="text-sm text-infra-500 mt-1">Jan - Feb 2025</p>
                        </div>
                        <div class="absolute left-1/2 transform -translate-x-1/2 w-8 h-8 bg-infra-300 rounded-full border-4 border-white shadow-lg z-10"></div>
                        <div class="hidden md:block w-1/2 pl-8">
                            <h3 class="text-xl font-bold text-infra-900">Field Testing</h3>
                            <p class="text-infra-600 mt-2">Deployment on test fleet vehicles, data collection validation, and algorithm refinement.</p>
                        </div>
                        <div class="md:hidden w-full pl-12 border-l-4 border-infra-300 ml-4 pb-8">
                            <h3 class="text-lg font-bold text-infra-900">Field Testing</h3>
                            <p class="text-sm text-infra-600 mt-1">Upcoming ‚Ä¢ Jan-Feb 2025</p>
                        </div>
                    </div>

                    <!-- Phase 5 -->
                    <div class="relative flex items-center justify-center opacity-30">
                        <div class="hidden md:block w-1/2 pr-8 text-right">
                            <h3 class="text-xl font-bold text-infra-900">Validation & Expo</h3>
                            <p class="text-infra-600 mt-2">Final system validation, documentation, and Senior Design Expo presentation preparation.</p>
                        </div>
                        <div class="absolute left-1/2 transform -translate-x-1/2 w-8 h-8 bg-infra-300 rounded-full border-4 border-white shadow-lg z-10"></div>
                        <div class="hidden md:block w-1/2 pl-8">
                            <span class="inline-block bg-infra-200 text-infra-700 px-3 py-1 rounded-full text-sm font-semibold">Upcoming</span>
                            <p class="text-sm text-infra-500 mt-1">Mar - Apr 2025</p>
                        </div>
                        <div class="md:hidden w-full pl-12 border-l-4 border-infra-300 ml-4">
                            <h3 class="text-lg font-bold text-infra-900">Validation & Expo</h3>
                            <p class="text-sm text-infra-600 mt-1">Upcoming ‚Ä¢ Mar-Apr 2025</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Broader Impact -->
    <section id="impact" class="py-24 bg-veg-900 text-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-4xl font-bold mb-4">Broader Impact</h2>
                <p class="text-veg-100 text-lg">Transforming utility infrastructure management through intelligent automation</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12">
                <div class="text-center">
                    <div class="w-16 h-16 mx-auto bg-white/10 rounded-full flex items-center justify-center mb-4">
                        <i data-lucide="building-2" class="h-8 w-8 text-utility-300"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">Utility Operations</h3>
                    <p class="text-veg-100 text-sm">Reduction in inspection labor costs by 75% while increasing survey frequency from annual to continuous monitoring.</p>
                </div>
                <div class="text-center">
                    <div class="w-16 h-16 mx-auto bg-white/10 rounded-full flex items-center justify-center mb-4">
                        <i data-lucide="flame-off" class="h-8 w-8 text-red-300"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">Wildfire Prevention</h3>
                    <p class="text-veg-100 text-sm">Early detection of high-risk vegetation contact points, reducing ignition risk by up to 60% in high-risk zones.</p>
                </div>
                <div class="text-center">
                    <div class="w-16 h-16 mx-auto bg-white/10 rounded-full flex items-center justify-center mb-4">
                        <i data-lucide="sun" class="h-8 w-8 text-yellow-300"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">Solar Efficiency</h3>
                    <p class="text-veg-100 text-sm">Application to solar farm vegetation monitoring, ensuring panel efficiency through automated growth detection.</p>
                </div>
                <div class="text-center">
                    <div class="w-16 h-16 mx-auto bg-white/10 rounded-full flex items-center justify-center mb-4">
                        <i data-lucide="trending-down" class="h-8 w-8 text-utility-300"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">Cost Savings</h3>
                    <p class="text-veg-100 text-sm">Preventative maintenance approach reduces emergency response costs by $2.4M annually per utility zone.</p>
                </div>
            </div>

            <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-8 border border-white/20">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                    <div>
                        <div class="text-4xl font-bold text-utility-300 mb-2">$2.4M</div>
                        <div class="text-sm text-veg-100">Estimated Annual Savings</div>
                    </div>
                    <div>
                        <div class="text-4xl font-bold text-utility-300 mb-2">60%</div>
                        <div class="text-sm text-veg-100">Wildfire Risk Reduction</div>
                    </div>
                    <div>
                        <div class="text-4xl font-bold text-utility-300 mb-2">24/7</div>
                        <div class="text-sm text-veg-100">Continuous Monitoring</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Team & Sponsor -->
    <section id="team" class="py-24 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-4xl font-bold text-infra-900 mb-4">Team & Sponsorship</h2>
                <p class="text-lg text-infra-600">Dedicated engineering team supported by industry leadership</p>
            </div>

            <!-- Sponsor Banner -->
            <div class="bg-gradient-to-r from-blue-600 to-blue-800 rounded-2xl p-8 mb-16 text-white flex flex-col md:flex-row items-center justify-between gap-6">
                <div class="flex items-center gap-6">
                    <div class="w-20 h-20 bg-white rounded-xl flex items-center justify-center text-blue-900 font-bold text-2xl">
                        NE
                    </div>
                    <div>
                        <div class="text-sm font-medium text-blue-100 uppercase tracking-wider mb-1">Project Sponsor</div>
                        <h3 class="text-2xl font-bold">NextEra Energy</h3>
                        <p class="text-blue-100">Industry-leading clean energy infrastructure provider</p>
                    </div>
                </div>
                <div class="text-right hidden md:block">
                    <div class="text-sm text-blue-100">Technical Advisory</div>
                    <div class="font-medium">Provided mentorship and field testing access</div>
                </div>
            </div>

            <!-- Team Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="bg-infra-50 rounded-xl p-6 border border-infra-200 hover:shadow-lg transition-all text-center group">
                    <div class="w-24 h-24 mx-auto bg-gradient-to-br from-utility-200 to-utility-300 rounded-full mb-4 flex items-center justify-center text-2xl text-utility-800 font-bold group-hover:scale-110 transition-transform">
                        JD
                    </div>
                    <h4 class="font-bold text-infra-900">Student Name</h4>
                    <p class="text-sm text-veg-600 font-medium mb-2">Mechanical Lead</p>
                    <p class="text-xs text-infra-500">Vibration analysis & housing design</p>
                </div>

                <div class="bg-infra-50 rounded-xl p-6 border border-infra-200 hover:shadow-lg transition-all text-center group">
                    <div class="w-24 h-24 mx-auto bg-gradient-to-br from-veg-200 to-veg-300 rounded-full mb-4 flex items-center justify-center text-2xl text-veg-800 font-bold group-hover:scale-110 transition-transform">
                        AS
                    </div>
                    <h4 class="font-bold text-infra-900">Student Name</h4>
                    <p class="text-sm text-veg-600 font-medium mb-2">Electrical Lead</p>
                    <p class="text-xs text-infra-500">Power systems & PCB design</p>
                </div>

                <div class="bg-infra-50 rounded-xl p-6 border border-infra-200 hover:shadow-lg transition-all text-center group">
                    <div class="w-24 h-24 mx-auto bg-gradient-to-br from-utility-200 to-veg-200 rounded-full mb-4 flex items-center justify-center text-2xl text-infra-800 font-bold group-hover:scale-110 transition-transform">
                        MK
                    </div>
                    <h4 class="font-bold text-infra-900">Student Name</h4>
                    <p class="text-sm text-veg-600 font-medium mb-2">Computer Lead</p>
                    <p class="text-xs text-infra-500">AI/ML & cloud architecture</p>
                </div>

                <div class="bg-infra-50 rounded-xl p-6 border border-infra-200 hover:shadow-lg transition-all text-center group">
                    <div class="w-24 h-24 mx-auto bg-gradient-to-br from-infra-200 to-infra-300 rounded-full mb-4 flex items-center justify-center text-2xl text-infra-800 font-bold group-hover:scale-110 transition-transform">
                        RL
                    </div>
                    <h4 class="font-bold text-infra-900">Student Name</h4>
                    <p class="text-sm text-veg-600 font-medium mb-2">Systems Lead</p>
                    <p class="text-xs text-infra-500">Integration & testing coordinator</p>
                </div>
            </div>

            <div class="mt-12 text-center">
                <div class="inline-flex items-center gap-2 text-infra-500 text-sm">
                    <i data-lucide="university" class="h-4 w-4"></i>
                    <span>Senior Design Project 2024-2025 ‚Ä¢ Department of Engineering</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-infra-900 text-infra-300 py-12 border-t border-infra-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <div class="col-span-2">
                    <div class="flex items-center gap-2 mb-4">
                        <i data-lucide="cpu" class="h-6 w-6 text-veg-500"></i>
                        <span class="font-bold text-lg text-white">IVVM System</span>
                    </div>
                    <p class="text-sm text-infra-400 mb-4 max-w-md">
                        Integrated Vehicular Vegetation Monitoring System for Utility Infrastructure. A senior design engineering project focused on automated infrastructure protection.
                    </p>
                    <div class="flex items-center gap-4">
                        <a href="#" class="text-infra-400 hover:text-white transition-colors">
                            <i data-lucide="github" class="h-5 w-5"></i>
                        </a>
                        <a href="#" class="text-infra-400 hover:text-white transition-colors">
                            <i data-lucide="linkedin" class="h-5 w-5"></i>
                        </a>
                        <a href="#" class="text-infra-400 hover:text-white transition-colors">
                            <i data-lucide="mail" class="h-5 w-5"></i>
                        </a>
                    </div>
                </div>
                <div>
                    <h4 class="text-white font-semibold mb-4">Project</h4>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#overview" class="hover:text-veg-400 transition-colors">Overview</a></li>
                        <li><a href="#architecture" class="hover:text-veg-400 transition-colors">Architecture</a></li>
                        <li><a href="#dashboard" class="hover:text-veg-400 transition-colors">Dashboard</a></li>
                        <li><a href="#engineering" class="hover:text-veg-400 transition-colors">Engineering</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-white font-semibold mb-4">Resources</h4>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="hover:text-veg-400 transition-colors">Technical Docs</a></li>
                        <li><a href="#" class="hover:text-veg-400 transition-colors">API Reference</a></li>
                        <li><a href="#" class="hover:text-veg-400 transition-colors">Field Test Data</a></li>
                        <li><a href="#" class="hover:text-veg-400 transition-colors">Contact Team</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-infra-800 pt-8 flex flex-col md:flex-row justify-between items-center gap-4">
                <p class="text-sm text-infra-500">
                    ¬© 2025 IVVM System Project. All rights reserved.
                </p>
                <div class="flex items-center gap-2 text-sm text-infra-500">
                    <span>Status:</span>
                    <span class="flex items-center gap-1 text-veg-400">
                        <span class="w-2 h-2 bg-veg-500 rounded-full animate-pulse"></span>
                        Development Active
                    </span>
                </div>
            </div>
        </div>
    </footer>

    <script>

        // Initialize Lucide Icons
        lucide.createIcons();

        // Mobile Menu Toggle
        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            const icon = document.getElementById('menuIcon');
            menu.classList.toggle('hidden');
            
            // Change icon
            if (menu.classList.contains('hidden')) {
                icon.setAttribute('data-lucide', 'menu');
            } else {
                icon.setAttribute('data-lucide', 'x');
            }
            lucide.createIcons();
        }

        // Navbar Scroll Effect
        window.addEventListener('scroll', function() {
            const navbar = document.getElementById('navbar');
            if (window.scrollY > 50) {
                navbar.classList.add('shadow-lg');
                navbar.classList.remove('glass-panel');
                navbar.classList.add('bg-white/95');
            } else {
                navbar.classList.remove('shadow-lg');
                navbar.classList.add('glass-panel');
                navbar.classList.remove('bg-white/95');
            }
        });

        // Global variables for DynamoDB data
        // dynamoDBService is already declared in global scope above
        window.vehicleDataMap = {}; // Map of captureId -> data (make it global)
        let vehicleDataMap = window.vehicleDataMap; // Alias for easier access
        // pendingLocations is already declared in global scope above

        // Local alias for initDynamoDBService (already defined in global scope above)
        function initDynamoDBService() {
            return window.initDynamoDBService();
        }

        // Load locations from DynamoDB and update UI - must be global for map initialization
        window.loadLocations = async function() {
            console.log('üîÑ loadLocations() called');
            
            const service = window.dynamoDBService || dynamoDBService;
            if (!service) {
                console.error('‚ùå DynamoDB service not initialized');
                // Try to initialize it
                if (typeof window.initDynamoDBService === 'function') {
                    window.initDynamoDBService();
                    const retryService = window.dynamoDBService || dynamoDBService;
                    if (!retryService) {
                        console.error('‚ùå Failed to initialize DynamoDB service');
                        // Show error in UI
                        const listContainer = document.getElementById('detectionsList');
                        if (listContainer) {
                            listContainer.innerHTML = `
                                <div class="text-center text-red-400 text-sm py-8">
                                    <i data-lucide="alert-circle" class="h-6 w-6 mx-auto mb-2"></i>
                                    <p>Failed to initialize DynamoDB service</p>
                                    <p class="text-xs mt-2">Check console for details</p>
                                </div>
                            `;
                        }
                        return;
                    }
                    // Retry after initialization
                    setTimeout(() => window.loadLocations(), 500);
                    return;
                } else {
                    console.error('‚ùå initDynamoDBService function not available');
                    return;
                }
            }

            console.log('‚úÖ Service available, fetching locations...');
            
            try {
                // Add timeout to API call
                const fetchPromise = service.fetchLocations({ limit: 100 });
                const timeoutPromise = new Promise((_, reject) => 
                    setTimeout(() => reject(new Error('API call timed out after 10 seconds')), 10000)
                );
                
                const locations = await Promise.race([fetchPromise, timeoutPromise]);
                console.log(`‚úÖ Fetched ${locations.length} locations from API`);
                
                // Check if using mock data
                const isUsingMock = service.isUsingMockData();
                const lastError = service.getLastError();
                
                // Show/hide warning banner
                showMockDataWarning(isUsingMock, lastError);
                
                // Store in map for quick lookup
                vehicleDataMap = {};
                locations.forEach(loc => {
                    vehicleDataMap[loc.captureId] = loc;
                });

                // Update sidebar
                console.log('üìã Updating detections list in sidebar...');
                updateDetectionsList(locations);
                console.log('‚úÖ Sidebar updated');
                
                // Update map markers
                const currentMap = window.map || map;
                console.log(`üìç Attempting to update map with ${locations.length} locations...`);
                console.log(`   Map ready: ${!!currentMap}, Google Maps ready: ${typeof google !== 'undefined' && !!google.maps}`);
                console.log(`   window.map: ${!!window.map}, local map: ${!!map}`);
                
                // Store locations for later if map isn't ready
                window.pendingLocations = locations;
                pendingLocations = locations;
                
                if (typeof google !== 'undefined' && google.maps) {
                    if (currentMap) {
                        console.log('‚úÖ Map is ready, creating markers now');
                        updateMapMarkers(locations);
                    } else {
                        console.warn('‚ö†Ô∏è Map not initialized yet, storing locations for when map is ready');
                        // Wait for map to be ready - will be handled by map initialization
                        // Check again after a short delay
                        setTimeout(() => {
                            const retryMap = window.map || map;
                            if (retryMap && locations && locations.length > 0) {
                                console.log('üîÑ Map ready on retry, creating markers');
                                updateMapMarkers(locations);
                            }
                        }, 1000);
                    }
                } else {
                    console.warn('‚ö†Ô∏è Google Maps API not loaded yet');
                }

                if (isUsingMock) {
                    console.warn(`‚ö†Ô∏è Using mock data (${locations.length} items). API error: ${lastError || 'Unknown'}`);
                } else {
                    console.log(`‚úÖ Loaded ${locations.length} locations from DynamoDB`);
                }
            } catch (error) {
                console.error('‚ùå Error loading locations:', error);
                console.error('Error details:', {
                    message: error.message,
                    stack: error.stack,
                    name: error.name
                });
                showMockDataWarning(true, error.message);
                
                // Show error in sidebar
                const listContainer = document.getElementById('detectionsList');
                if (listContainer) {
                    listContainer.innerHTML = `
                        <div class="text-center text-red-400 text-sm py-8">
                            <i data-lucide="alert-circle" class="h-6 w-6 mx-auto mb-2"></i>
                            <p class="font-semibold">Error loading detections</p>
                            <p class="text-xs mt-2 text-infra-400">${error.message || 'Unknown error'}</p>
                            <button onclick="window.loadLocations()" class="mt-4 px-4 py-2 bg-red-600 hover:bg-red-700 rounded text-white text-xs transition-colors">
                                Retry
                            </button>
                        </div>
                    `;
                    // Re-initialize icons
                    if (typeof lucide !== 'undefined') {
                        lucide.createIcons();
                    }
                }
            }
        };
        
        // Also create local alias
        async function loadLocations() {
            return window.loadLocations();
        }

        // Show warning banner when using mock data - make it globally accessible
        window.showMockDataWarning = function(show, errorMessage) {
            let banner = document.getElementById('mockDataWarning');
            
            if (show) {
                if (!banner) {
                    // Create banner
                    banner = document.createElement('div');
                    banner.id = 'mockDataWarning';
                    banner.className = 'fixed top-20 left-1/2 transform -translate-x-1/2 z-50 bg-yellow-500 text-yellow-900 px-6 py-3 rounded-lg shadow-lg flex items-center gap-3 max-w-2xl';
                    banner.innerHTML = `
                        <i data-lucide="alert-triangle" class="h-5 w-5 flex-shrink-0"></i>
                        <div class="flex-1">
                            <strong>Using Mock Data</strong>
                            <p class="text-sm" id="mockDataError">API error: ${errorMessage || 'Unknown error'}</p>
                        </div>
                        <button onclick="document.getElementById('mockDataWarning').remove()" class="text-yellow-900 hover:text-yellow-700">
                            <i data-lucide="x" class="h-5 w-5"></i>
                        </button>
                    `;
                    document.body.appendChild(banner);
                    lucide.createIcons();
                } else {
                    // Update existing banner
                    const errorText = document.getElementById('mockDataError');
                    if (errorText) {
                        errorText.textContent = `API error: ${errorMessage || 'Unknown error'}`;
                    }
                    banner.style.display = 'flex';
                }
            } else if (banner) {
                // Hide banner
                banner.remove();
            }
        };
        
        // Also create local alias
        function showMockDataWarning(show, errorMessage) {
            return window.showMockDataWarning(show, errorMessage);
        }

        // Update detections list in sidebar - make it globally accessible
        window.updateDetectionsList = function(locations) {
            console.log(`üìã updateDetectionsList called with ${locations ? locations.length : 0} locations`);
            const listContainer = document.getElementById('detectionsList');
            if (!listContainer) {
                console.error('‚ùå detectionsList container not found');
                return;
            }

            if (!locations || locations.length === 0) {
                console.warn('‚ö†Ô∏è No locations to display');
                listContainer.innerHTML = `
                    <div class="text-center text-infra-400 text-sm py-8">
                        <i data-lucide="inbox" class="h-6 w-6 mx-auto mb-2"></i>
                        <p>No detections found</p>
                    </div>
                `;
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
                return;
            }

            try {
                // Sort by timestamp (newest first)
                const sorted = [...locations].sort((a, b) => {
                    const dateA = a.fullTimestamp ? new Date(a.fullTimestamp) : new Date(0);
                    const dateB = b.fullTimestamp ? new Date(b.fullTimestamp) : new Date(0);
                    return dateB - dateA;
                });

                console.log(`üìã Rendering ${sorted.length} detections in sidebar...`);

                listContainer.innerHTML = sorted.map(loc => {
                const riskColors = {
                    'HIGH': 'bg-red-500/20 text-red-400',
                    'MEDIUM': 'bg-orange-500/20 text-orange-400',
                    'LOW': 'bg-green-500/20 text-green-400'
                };
                const riskLabel = {
                    'HIGH': 'HIGH',
                    'MEDIUM': 'MED',
                    'LOW': 'LOW'
                };

                return `
                    <div class="bg-infra-700/50 p-3 rounded-lg border border-infra-600 hover:border-utility-500 transition-colors cursor-pointer" onclick="window.selectVehicle('${loc.captureId}')">
                        <div class="flex justify-between items-start mb-2">
                            <span class="font-mono font-semibold text-utility-400">${loc.deviceName || loc.vehicleId}</span>
                            <span class="text-xs ${riskColors[loc.risk]} px-2 py-0.5 rounded">${riskLabel[loc.risk]}</span>
                        </div>
                        <div class="space-y-1 text-xs text-infra-300">
                            <div class="flex items-center gap-2">
                                <i data-lucide="clock" class="h-3 w-3"></i>
                                <span>${loc.timestamp || 'N/A'}</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i data-lucide="map-pin" class="h-3 w-3"></i>
                                <span>${loc.lat.toFixed(4)}, ${loc.lng.toFixed(4)}</span>
                            </div>
                        </div>
                    </div>
                `;
                }).join('');

                console.log('‚úÖ Sidebar HTML updated, creating icons...');
                
                // Re-initialize lucide icons
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                    console.log('‚úÖ Icons created');
                } else {
                    console.warn('‚ö†Ô∏è Lucide icons not available');
                }
                
                console.log(`‚úÖ Sidebar updated with ${sorted.length} detections`);
            } catch (error) {
                console.error('‚ùå Error updating detections list:', error);
                listContainer.innerHTML = `
                    <div class="text-center text-red-400 text-sm py-8">
                        <i data-lucide="alert-circle" class="h-6 w-6 mx-auto mb-2"></i>
                        <p>Error displaying detections</p>
                        <p class="text-xs mt-2 text-infra-400">${error.message}</p>
                    </div>
                `;
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            }
        };
        
        // Also create local alias
        function updateDetectionsList(locations) {
            return window.updateDetectionsList(locations);
        }

        // Update map markers
        function updateMapMarkers(locations) {
            // Use window.map to ensure we have the right reference
            const currentMap = window.map || map;
            if (!currentMap) {
                console.warn('‚ö†Ô∏è Map not ready yet, will retry when map is initialized');
                // Retry after a short delay if map isn't ready
                setTimeout(() => {
                    const retryMap = window.map || map;
                    if (retryMap && locations && locations.length > 0) {
                        console.log('üîÑ Retrying marker creation...');
                        updateMapMarkers(locations);
                    }
                }, 1000);
                return;
            }
            
            // Update local references
            map = currentMap;

            if (!locations || locations.length === 0) {
                console.warn('‚ö†Ô∏è No locations to display on map');
                return;
            }

            console.log(`üó∫Ô∏è Creating ${locations.length} markers on map...`);
            console.log(`   Map object:`, currentMap);
            console.log(`   Map container:`, currentMap.getDiv());
            console.log(`   Sample location data:`, locations[0]);

            // Clear existing markers
            const currentMarkers = window.markers || markers;
            const currentInfoWindows = window.infoWindows || infoWindows;
            Object.values(currentMarkers).forEach(marker => {
                if (marker && marker.setMap) {
                    marker.setMap(null);
                }
            });
            Object.values(currentInfoWindows).forEach(iw => {
                if (iw && iw.close) {
                    iw.close();
                }
            });
            window.markers = {};
            window.infoWindows = {};
            markers = {};
            infoWindows = {};

            let createdCount = 0;
            let errorCount = 0;

            // Create new markers
            locations.forEach((loc, index) => {
                // Validate coordinates
                if (!loc.lat || !loc.lng || isNaN(loc.lat) || isNaN(loc.lng)) {
                    console.warn(`‚ö†Ô∏è Invalid coordinates for ${loc.captureId}: lat=${loc.lat}, lng=${loc.lng}`);
                    return;
                }
                
                console.log(`Creating marker ${index + 1}/${locations.length}: ${loc.captureId} at (${loc.lat}, ${loc.lng})`);
                console.log(`   Data from API - Risk: ${loc.risk}, bgColor: ${loc.bgColor}, device: ${loc.deviceName}`);
                
                // Create custom colored circle marker based on risk level
                const markerIcon = {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 10,
                    fillColor: loc.bgColor || '#dc2626',
                    fillOpacity: 1,
                    strokeColor: '#ffffff',
                    strokeWeight: 2
                };

                let marker = null;
                try {
                    marker = new google.maps.Marker({
                        position: { lat: parseFloat(loc.lat), lng: parseFloat(loc.lng) },
                        map: currentMap,
                        title: `${loc.deviceName || loc.captureId} - ${loc.risk} Risk`,
                        icon: markerIcon,
                        animation: google.maps.Animation.DROP,
                        visible: true,
                        optimized: false // Ensure marker is rendered
                    });
                    
                    // Verify marker was created and is on the map
                if (marker) {
                        createdCount++;
                        const markerMap = marker.getMap();
                        const markerPos = marker.getPosition();
                        console.log(`‚úÖ Marker ${createdCount} created for ${loc.captureId}`);
                        console.log(`   Position: (${loc.lat}, ${loc.lng})`);
                        console.log(`   Risk: ${loc.risk}, Color: ${loc.bgColor}`);
                        console.log(`   Marker on map: ${!!markerMap}`);
                        console.log(`   Marker position valid: ${!!markerPos}`);
                        
                        if (!markerMap) {
                            console.error(`‚ùå Marker created but not on map! Forcing setMap...`);
                            // Force set map
                            marker.setMap(currentMap);
                        }
                    } else {
                        errorCount++;
                        console.error(`‚ùå Failed to create marker for ${loc.captureId}`);
                        return; // Skip this location
                    }
                } catch (markerError) {
                    errorCount++;
                    console.error(`‚ùå Error creating marker for ${loc.captureId}:`, markerError);
                    return; // Skip this location
                }

                // Only create info window and listeners if marker was created
                if (marker) {
                    const infoWindow = new google.maps.InfoWindow({
                        content: `
                            <div style="font-family: 'Inter', sans-serif; min-width: 200px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <h3 style="margin: 0; font-weight: 600; font-size: 14px; color: #0f172a;">${loc.deviceName || loc.captureId}</h3>
                                    <span style="background-color: ${loc.bgColor}20; color: ${loc.bgColor}; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">${loc.risk}</span>
                                </div>
                                <div style="font-size: 12px; color: #475569; line-height: 1.6;">
                                    <div><strong>Location:</strong> ${loc.location}</div>
                                    <div><strong>Class:</strong> ${loc.species}</div>
                                    <div><strong>Confidence:</strong> ${(loc.confidence * 100).toFixed(1)}%</div>
                                    <div><strong>Time:</strong> ${loc.timestamp}</div>
                                </div>
                            </div>
                        `
                    });

                    marker.addListener('click', () => {
                        Object.values(window.infoWindows || infoWindows).forEach(iw => {
                            if (iw && iw.close) iw.close();
                        });
                        infoWindow.open(currentMap, marker);
                        selectVehicle(loc.captureId);
                    });

                    markers[loc.captureId] = marker;
                    infoWindows[loc.captureId] = infoWindow;
                }
            });
            
            // Update window references
            window.markers = markers;
            window.infoWindows = infoWindows;

            console.log(`‚úÖ Created ${createdCount} markers on map (${errorCount} errors)`);
            console.log(`   Total markers in object: ${Object.keys(markers).length}`);
            console.log(`   window.markers count: ${Object.keys(window.markers).length}`);
            
            // Force map to refresh/redraw
            if (currentMap) {
                google.maps.event.trigger(currentMap, 'resize');
            }

            // Center map on markers if we have any
            if (locations.length > 0) {
                try {
                    const bounds = new google.maps.LatLngBounds();
                    locations.forEach(loc => {
                        if (loc.lat && loc.lng && !isNaN(loc.lat) && !isNaN(loc.lng)) {
                            bounds.extend({ lat: loc.lat, lng: loc.lng });
                        }
                    });
                    if (!bounds.isEmpty()) {
                        currentMap.fitBounds(bounds);
                        console.log('‚úÖ Map centered on markers');
                    }
                } catch (error) {
                    console.error('Error centering map:', error);
                    // Fallback to center on first location
                    if (locations[0] && locations[0].lat && locations[0].lng) {
                        currentMap.setCenter({ lat: locations[0].lat, lng: locations[0].lng });
                        currentMap.setZoom(12);
                    }
                }
            }
        }

        // Select Vehicle Function (updated for DynamoDB)
        // Select vehicle function - make it globally accessible
        window.selectVehicle = function(captureId) {
            const detailDiv = document.getElementById('vehicleDetail');
            // vehicleDataMap should be accessible from global scope
            const data = (window.vehicleDataMap || vehicleDataMap) && (window.vehicleDataMap || vehicleDataMap)[captureId] 
                ? (window.vehicleDataMap || vehicleDataMap)[captureId] 
                : null;
            
            if (!data) {
                detailDiv.innerHTML = `
                    <p class="text-sm text-infra-400 text-center">Location data not found</p>
                `;
                return;
            }

            // Center map on selected location
            const currentMap = window.map || map;
            const currentMarkers = window.markers || markers;
            const currentInfoWindows = window.infoWindows || infoWindows;
            
            if (currentMap && currentMarkers[captureId]) {
                const marker = currentMarkers[captureId];
                currentMap.setCenter(marker.getPosition());
                currentMap.setZoom(16);
                if (currentInfoWindows[captureId]) {
                    currentInfoWindows[captureId].open(currentMap, marker);
                }
                }

                // Update detail panel
            const riskColors = {
                'HIGH': 'text-red-400',
                'MEDIUM': 'text-orange-400',
                'LOW': 'text-green-400'
            };

                detailDiv.innerHTML = `
                    <div class="flex gap-3">
                        <div class="w-20 h-20 bg-infra-700 rounded overflow-hidden flex-shrink-0">
                        <img src="${data.image}" alt="Vegetation" class="w-full h-full object-cover" onerror="this.src='https://images.unsplash.com/photo-1502082553048-f009c37129b9?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80'">
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-start mb-1">
                            <span class="font-mono font-bold text-white">${data.deviceName || data.captureId}</span>
                            <span class="text-xs ${riskColors[data.risk]} font-semibold">${data.risk}</span>
                            </div>
                            <div class="text-xs text-infra-300 space-y-1">
                            <div>Class: ${data.species}</div>
                            <div>Confidence: ${(data.confidence * 100).toFixed(1)}%</div>
                            <div>Location: ${data.location}</div>
                            <div>Time: ${data.timestamp}</div>
                            ${data.numSatellites ? `<div>GPS Sats: ${data.numSatellites}</div>` : ''}
                            </div>
                        </div>
                    </div>
                    <button class="w-full mt-3 py-2 bg-utility-600 hover:bg-utility-700 rounded text-xs font-medium transition-colors">
                        Generate Work Order
                    </button>
                `;
        };
        
        // Also create local alias
        function selectVehicle(captureId) {
            return window.selectVehicle(captureId);
        }

        // Map Zoom Function
        function zoomMap(direction) {
            const currentMap = window.map || map;
            if (currentMap) {
                const currentZoom = currentMap.getZoom();
                currentMap.setZoom(currentZoom + (direction > 0 ? 1 : -1));
            }
        }

        // Initialize everything on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize DynamoDB service early
            initDynamoDBService();
            
            // Map initialization will be handled by initMap callback
            // Data loading will happen automatically when map is ready (see initializeMap function)

            // Refresh data every 5 minutes (only if service and map are ready)
            setInterval(function() {
                if (dynamoDBService && map) {
                    loadLocations();
                }
            }, 5 * 60 * 1000);
        });

        // Fallback initialization if callback doesn't work
        window.addEventListener('load', function() {
            // Wait a bit for the callback to fire
            setTimeout(function() {
                if (typeof map === 'undefined' || !map) {
                    // If map wasn't initialized by callback, try manual init
                    if (typeof google !== 'undefined' && google.maps) {
                        console.log('Initializing map via fallback method');
                        initMap();
                    } else {
                        console.error('Google Maps API not available after page load');
                        showMapError('Google Maps API failed to load. Check browser console (F12) for details.');
                    }
                }
            }, 2000);
        });

        // Debug function - manually refresh markers (for testing)
        window.debugRefreshMarkers = function() {
            console.log('üîß Manual marker refresh triggered');
            const currentMap = window.map || map;
            const currentMarkers = window.markers || markers;
            console.log('Map state:', {
                mapExists: !!currentMap,
                windowMapExists: !!window.map,
                markersCount: Object.keys(currentMarkers).length,
                googleMapsReady: typeof google !== 'undefined' && !!google.maps
            });
            
            if (dynamoDBService && currentMap) {
                console.log('‚úÖ Both service and map ready, loading locations...');
                loadLocations();
            } else if (!currentMap) {
                console.error('‚ùå Map not initialized');
                console.log('   window.map:', window.map);
                console.log('   local map:', map);
            } else if (!dynamoDBService) {
                console.error('‚ùå DynamoDB service not initialized');
                initDynamoDBService();
                setTimeout(loadLocations, 500);
            }
        };
        
        // Debug function - test marker creation directly
        window.debugCreateTestMarker = function() {
            const currentMap = window.map || map;
            if (!currentMap) {
                console.error('‚ùå Map not ready');
                return;
            }
            
            console.log('üß™ Creating test marker at (38.921574, -83.123456)...');
            const testMarker = new google.maps.Marker({
                position: { lat: 38.921574, lng: -83.123456 },
                map: currentMap,
                title: 'Test Marker',
                animation: google.maps.Animation.DROP
            });
            
            if (testMarker) {
                console.log('‚úÖ Test marker created:', testMarker);
                console.log('   Marker on map:', testMarker.getMap());
                console.log('   Marker position:', testMarker.getPosition());
            } else {
                console.error('‚ùå Failed to create test marker');
            }
        };

        // Smooth Scroll